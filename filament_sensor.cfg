[gcode_macro SFS_ENABLE]
description: Enable smart filament sensor
gcode:
 M118 ENABLING The Encoder Sensor
 G92 E0
 SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE=1

[gcode_macro SFS_DISABLE]
description: Disable smart filament sensor
gcode:
 M118 DISABLING The Encoder Sensor
 G92 E0
 SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE=0

[delayed_gcode DISABLEFILAMENTSENSOR] ; Disable sensor for 1 sec after restart
initial_duration: 1
gcode:
 SET_FILAMENT_SENSOR SENSOR=encoder_sensor ENABLE=0

[filament_switch_sensor switch_sensor]
switch_pin: umb:gpio6
pause_on_runout: False
runout_gcode:
 PAUSE
 M118 Filament switch runout triggered
insert_gcode:
 M118 Filament switch insert triggered

[filament_motion_sensor encoder_sensor]
switch_pin: umb:gpio18
detection_length: 3.88 # accuracy
extruder: extruder
pause_on_runout: False
runout_gcode:
 PAUSE
 M118 Filament encoder runout triggered
insert_gcode:
 M118 Filament encoder movement triggered